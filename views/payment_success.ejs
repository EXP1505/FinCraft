<%- include('partials/header') %>
<%- include('partials/navbar') %>

<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <!-- Success Animation -->
            <div class="text-center mb-5">
                <div class="success-checkmark">
                    <div class="check-icon">
                        <span class="icon-line line-tip"></span>
                        <span class="icon-line line-long"></span>
                        <div class="icon-circle"></div>
                        <div class="icon-fix"></div>
                    </div>
                </div>
            </div>

            <!-- Success Message -->
            <div class="card shadow-lg border-0">
                <div class="card-body text-center p-5">
                    <h1 class="text-success mb-3">
                        <i class="fas fa-check-circle me-2"></i>
                        Payment Successful!
                    </h1>
                    <p class="lead text-muted mb-4">
                        Welcome to Fincraft Professional! Your account has been upgraded successfully.
                    </p>

                    <!-- Order Details -->
                    <div class="bg-light rounded p-4 mb-4">
                        <div class="row text-center">
                            <div class="col-md-4 mb-3">
                                <div class="order-detail">
                                    <i class="fas fa-crown text-primary fa-2x mb-2"></i>
                                    <h5 class="mb-1">Plan</h5>
                                    <p class="text-muted mb-0" id="planName">Professional</p>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="order-detail">
                                    <i class="fas fa-dollar-sign text-success fa-2x mb-2"></i>
                                    <h5 class="mb-1">Amount</h5>
                                    <p class="text-muted mb-0">$<span id="planPrice">29</span>/month</p>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="order-detail">
                                    <i class="fas fa-calendar-alt text-info fa-2x mb-2"></i>
                                    <h5 class="mb-1">Next Billing</h5>
                                    <p class="text-muted mb-0" id="nextBilling">July 10, 2025</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- What's Included -->
                    <div class="text-start mb-4">
                        <h4 class="text-center mb-4">
                            <i class="fas fa-gift me-2"></i>
                            What's Included in Your Pro Plan
                        </h4>
                        <div class="row">
                            <div class="col-md-6">
                                <ul class="list-unstyled">
                                    <li class="mb-2">
                                        <i class="fas fa-check text-success me-2"></i>
                                        Unlimited stock watchlist
                                    </li>
                                    <li class="mb-2">
                                        <i class="fas fa-check text-success me-2"></i>
                                        Advanced charts & indicators
                                    </li>
                                    <li class="mb-2">
                                        <i class="fas fa-check text-success me-2"></i>
                                        AI-powered recommendations
                                    </li>
                                    <li class="mb-2">
                                        <i class="fas fa-check text-success me-2"></i>
                                        Priority broker access
                                    </li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <ul class="list-unstyled">
                                    <li class="mb-2">
                                        <i class="fas fa-check text-success me-2"></i>
                                        Advanced analytics dashboard
                                    </li>
                                    <li class="mb-2">
                                        <i class="fas fa-check text-success me-2"></i>
                                        Real-time market alerts
                                    </li>
                                    <li class="mb-2">
                                        <i class="fas fa-check text-success me-2"></i>
                                        Export trading reports
                                    </li>
                                    <li class="mb-2">
                                        <i class="fas fa-check text-success me-2"></i>
                                        Priority email support
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="d-grid gap-2 d-md-flex justify-content-md-center">
                        <a href="/dashboard" class="btn btn-primary btn-lg me-md-2">
                            <i class="fas fa-tachometer-alt me-2"></i>
                            Go to Dashboard
                        </a>
                        <a href="/stocks" class="btn btn-outline-primary btn-lg">
                            <i class="fas fa-chart-line me-2"></i>
                            Start Trading
                        </a>
                    </div>

                    <!-- Additional Info -->
                    <div class="mt-4 p-3 bg-info bg-opacity-10 rounded">
                        <div class="row text-center">
                            <div class="col-md-6 mb-2">
                                <small class="text-muted">
                                    <i class="fas fa-envelope me-1"></i>
                                    Confirmation email sent to your inbox
                                </small>
                            </div>
                            <div class="col-md-6 mb-2">
                                <small class="text-muted">
                                    <i class="fas fa-undo me-1"></i>
                                    Cancel anytime from your account settings
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Receipt Card -->
            <div class="card mt-4 shadow-sm">
                <div class="card-header bg-light">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            <i class="fas fa-receipt me-2"></i>
                            Transaction Receipt
                        </h5>
                        <button class="btn btn-sm btn-outline-primary" onclick="printReceipt()">
                            <i class="fas fa-print me-1"></i>
                            Print Receipt
                        </button>
                    </div>
                </div>
                <div class="card-body" id="receiptContent">
                    <div class="row mb-3">
                        <div class="col-6">
                            <strong>Transaction ID:</strong><br>
                            <span class="text-muted" id="transactionId">TXN-SS-2025-001</span>
                        </div>
                        <div class="col-6 text-end">
                            <strong>Date:</strong><br>
                            <span class="text-muted" id="transactionDate">June 10, 2025</span>
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-6">
                            <strong>Payment Method:</strong><br>
                            <span class="text-muted">Credit Card ****1234</span>
                        </div>
                        <div class="col-6 text-end">
                            <strong>Status:</strong><br>
                            <span class="badge bg-success">Completed</span>
                        </div>
                    </div>
                    <hr>
                    <div class="row">
                        <div class="col-8">
                            <strong>Fincraft Professional Plan</strong><br>
                            <small class="text-muted">Monthly subscription</small>
                        </div>
                        <div class="col-4 text-end">
                            <strong>$<span id="receiptAmount">29.00</span></strong>
                        </div>
                    </div>
                    <div class="row mt-2">
                        <div class="col-8">
                            <span class="text-muted">Tax</span>
                        </div>
                        <div class="col-4 text-end">
                            <span class="text-muted">$<span id="receiptTax">2.90</span></span>
                        </div>
                    </div>
                    <hr>
                    <div class="row">
                        <div class="col-8">
                            <strong>Total Amount</strong>
                        </div>
                        <div class="col-4 text-end">
                            <strong>$<span id="receiptTotal">31.90</span></strong>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Support Section -->
            <div class="text-center mt-4 mb-5">
                <h5 class="mb-3">Need Help?</h5>
                <p class="text-muted mb-3">
                    Our support team is here to help you get the most out of your Fincraft Pro account.
                </p>
                <div class="d-grid gap-2 d-md-flex justify-content-md-center">
                    <a href="/support" class="btn btn-outline-secondary">
                        <i class="fas fa-life-ring me-2"></i>
                        Contact Support
                    </a>
                    <a href="/help" class="btn btn-outline-secondary">
                        <i class="fas fa-book me-2"></i>
                        User Guide
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Get URL parameters
const urlParams = new URLSearchParams(window.location.search);
const plan = urlParams.get('plan');
const price = urlParams.get('price');

// Update plan details
if (plan && price) {
    const planNames = {
        'pro': 'Professional',
        'enterprise': 'Enterprise'
    };
    
    document.getElementById('planName').textContent = planNames[plan] || 'Professional';
    document.getElementById('planPrice').textContent = price;
    document.getElementById('receiptAmount').textContent = price + '.00';
    
    // Calculate tax and total
    const tax = (parseFloat(price) * 0.1).toFixed(2);
    const total = (parseFloat(price) * 1.1).toFixed(2);
    
    document.getElementById('receiptTax').textContent = tax;
    document.getElementById('receiptTotal').textContent = total;
}

// Set next billing date (1 month from now)
const nextBillingDate = new Date();
nextBillingDate.setMonth(nextBillingDate.getMonth() + 1);
document.getElementById('nextBilling').textContent = nextBillingDate.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
});

// Set current date
document.getElementById('transactionDate').textContent = new Date().toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
});

// Generate random transaction ID
const transactionId = 'TXN-SS-' + new Date().getFullYear() + '-' + Math.floor(Math.random() * 10000).toString().padStart(4, '0');
document.getElementById('transactionId').textContent = transactionId;

// Print receipt function
function printReceipt() {
    const receiptContent = document.getElementById('receiptContent').innerHTML;
    const printWindow = window.open('', '_blank');
    
    printWindow.document.write(`
        <html>
            <head>
                <title>Fincraft Receipt</title>
                <style>
                    body { font-family: Arial, sans-serif; padding: 20px; }
                    .row { display: flex; margin-bottom: 10px; }
                    .col-6 { width: 50%; }
                    .col-8 { width: 66.67%; }
                    .col-4 { width: 33.33%; }
                    .text-end { text-align: right; }
                    hr { margin: 15px 0; }
                    .badge { background-color: #28a745; color: white; padding: 4px 8px; border-radius: 4px; }
                </style>
            </head>
            <body>
                <h2>Fincraft Transaction Receipt</h2>
                ${receiptContent}
            </body>
        </html>
    `);
    
    printWindow.document.close();
    printWindow.print();
}

// Animate success checkmark on load
window.addEventListener('load', function() {
    setTimeout(() => {
        document.querySelector('.success-checkmark').classList.add('animate');
    }, 500);
});
</script>

<style>
.success-checkmark {
    width: 80px;
    height: 115px;
    margin: 0 auto;
    position: relative;
}

.success-checkmark .check-icon {
    width: 80px;
    height: 80px;
    position: relative;
    border-radius: 50%;
    box-sizing: content-box;
    border: 4px solid #4CAF50;
}

.success-checkmark .check-icon::before {
    top: 3px;
    left: -2px;
    width: 30px;
    transform-origin: 100% 50%;
    border-radius: 100px 0 0 100px;
}

.success-checkmark .check-icon::after {
    top: 0;
    left: 30px;
    width: 60px;
    transform-origin: 0 50%;
    border-radius: 0 100px 100px 0;
    animation: rotate-circle 4.25s ease-in;
}

.success-checkmark .check-icon::before,
.success-checkmark .check-icon::after {
    content: '';
    height: 100px;
    position: absolute;
    background: #FFFFFF;
    transform: rotate(-45deg);
}

.success-checkmark .check-icon .icon-line {
    height: 5px;
    background-color: #4CAF50;
    display: block;
    border-radius: 2px;
    position: absolute;
    z-index: 10;
}

.success-checkmark .check-icon .icon-line.line-tip {
    top: 46px;
    left: 14px;
    width: 25px;
    transform: rotate(45deg);
    animation: icon-line-tip 0.75s;
}

.success-checkmark .check-icon .icon-line.line-long {
    top: 38px;
    right: 8px;
    width: 47px;
    transform: rotate(-45deg);
    animation: icon-line-long 0.75s;
}

.success-checkmark .check-icon .icon-circle {
    top: -4px;
    left: -4px;
    z-index: 10;
    width: 80px;
    height: 80px;
    border-radius: 50%;
    position: absolute;
    box-sizing: content-box;
    border: 4px solid rgba(76, 175, 80, .5);
}

.success-checkmark .check-icon .icon-fix {
    top: 8px;
    width: 5px;
    left: 26px;
    z-index: 1;
    height: 85px;
    position: absolute;
    transform: rotate(-45deg);
    background-color: #FFFFFF;
}

@keyframes rotate-circle {
    0% {
        transform: rotate(-45deg);
    }
    5% {
        transform: rotate(-45deg);
    }
    12% {
        transform: rotate(-405deg);
    }
    100% {
        transform: rotate(-405deg);
    }
}

@keyframes icon-line-tip {
    0% {
        width: 0;
        left: 1px;
        top: 19px;
    }
    54% {
        width: 0;
        left: 1px;
        top: 19px;
    }
    70% {
        width: 50px;
        left: -8px;
        top: 37px;
    }
    84% {
        width: 17px;
        left: 21px;
        top: 48px;
    }
    100% {
        width: 25px;
        left: 14px;
        top: 45px;
    }
}

@keyframes icon-line-long {
    0% {
        width: 0;
        right: 46px;
        top: 54px;
    }
    65% {
        width: 0;
        right: 46px;
        top: 54px;
    }
    84% {
        width: 55px;
        right: 0px;
        top: 35px;
    }
    100% {
        width: 47px;
        right: 8px;
        top: 38px;
    }
}

.order-detail {
    padding: 1rem;
}

.card {
    border-radius: 15px;
}

.btn-lg {
    padding: 0.75rem 2rem;
    font-size: 1.1rem;
}

@media print {
    .btn, .card-header, nav, footer {
        display: none !important;
    }
}
</style>

<%- include('partials/footer') %>